Widget.types.page_type.types.default = {
	handle_preview: function(page_id, page_type) {
		
	},
	
	handle_admin: function(page_id, container, page_type) {
		var filled_modules = jQuery('<div/>').addClass('filled_modules').appendTo(container);
		var available_modules = jQuery('<ul/>').addClass('available_modules draggable').appendTo(container);
		
		page_type.callPageTypeMethod('adminListPossibleFrontendModules', function(modules) {
			var dragOptions = {
				cursor: "move",
				helper: 'clone',
				containment: ".contents_container",
				connectToSortable: '.filled_modules > .target'
			};
			jQuery.each(modules, function(object_type, module_name) {
				var element = jQuery('<li/>').text(module_name).attr('data-object-type', object_type).draggable(dragOptions).sortable();
				element.appendTo(available_modules);
			});
		});
		
		page_type.callPageTypeMethod('adminListFilledFrontendModules', function(containers) {
			jQuery.each(containers, function(container_name, params) {
				var target = jQuery('<ul>').addClass('target '+container_name).css({float: 'left', width: '40%', minHeight: '300px', border: '1px solid red'}).data('container_name', container_name).appendTo(filled_modules);

				jQuery.each(params.contents, function(object_id, content) {
					jQuery('<li/>').text(content.object_type_display_name).attr({'data-object-type': content.object_type, 'data-container': container_name, 'data-object-id': object_id}).appendTo(target);
				});
			});
			
			filled_modules.find('.target').sortable({
				connectWith: filled_modules.find('.target'),
				helper: 'clone',
				update: function(event, ui) {
					if(ui.sender) {
						return;
					}
					var target = jQuery(this);
					var item = ui.item;
					var position = target.children().index(item);
					// 3 types of operations:
					// 1. Internal move
					if(target.data('container_name') === item.attr('data-container')) {
						// …
						return;
					}
					// 2. From other container
					if(item.attr('data-container')) {
						// …
						return;
					}
					// 3. New element
					item.attr('data-container', target.data('container_name'));
					// add obeject, set id;
					// page_type.callPageTypeMethod('', function(id) {
					// 	item.attr('data-obeject-id', id);
					// });
				}
			});
		});
		
		//Parser stuff
		page_type.callPageTypeMethod('adminGetContainers', function(container_html) {
			if(container_html) {
				jQuery.parseHTML(container_html).appendTo(filled_modules);
			}
		});
	}
};