jQuery(document).ready(function() {
	// init main content
	AdminInterface.content.find('table.link_list').prepareWidget(function(link_list) {

		// init sidebar
		var sidebar;
		AdminInterface.sidebar.find('.ui-list').prepareWidget(function(widget) {
			sidebar = widget;
			sidebar.settings.row_click_active_mode = 'activate';
			this.initial_selection = "{{writeRequestValue=link_category_id}}";
			if(this.initial_selection) {
				this.initial_selection = isNaN(this.initial_selection) ? this.initial_selection : parseInt(this.initial_selection);
				sidebar.handle('loaded', function() {
					sidebar.activate_row(sidebar.row_from_row_data({id: initial_selection}));
				}, true, true);
			}
			
			sidebar.handle('list.row-click', function(event, row, element) {
				var link_category_id = element.data('link_category_id');
				if(!element.is('.ui-state-active')) {
					// handle initial_selection for custom elements
				 	link_category_id = null;
				}
				link_list.setOption('link_category_id', link_category_id);
				link_list.reload();
			});
		});

		// init info_bar
		AdminInterface.info_bar.prepareWidget(function(info_bar) {
			info_bar.add_button('add-new-item', function() {
				Widget.create('link_detail', function(widget) {
					widget.content.find("select[name='link_category_id']").val(link_list.getOption('link_category_id'));
					widget.open();
					widget.save_callback = function() {
						link_list.reload();
					};
				});
			}, 'n', true).add_button('add-new-item', function() {
				Widget.create('sidebar_input', function(widget) {
					widget.add_new_sidebar_input("{{writeString=wns.link_category.default_name}}", 'LinkCategory', sidebar, 'cmos-link_categories_changed');
				});
			}).add_search_input("{{writeString=wns.search.enter_search}}", function(search) {
				if(link_list.setSearch(search)) {
					link_list.reload();
				}
			});
			if(isNaN(this.initial_selection) === false) {
				info_bar.add_button('remove-item', function() {
					// do something, alert delete with/without contained items, permissions
				});
			}

			// add row_count_info
			info_bar.add_row_count_info_for_list(link_list);
		});
	});
});