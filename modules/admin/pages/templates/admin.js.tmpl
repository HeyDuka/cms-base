jQuery(document).ready(function() {
	var page_detail = null;
	Widget.createWithElement('page_detail', function(event, widget) {
		page_detail = widget;
		AdminInterface.content.append(widget._element);
	}, jQuery.noop);
	
	// init main content
	var page_tree = null;
	var click_handler = function(event, row, page_id) {
		console.log(page_id);
		page_detail.load_page(page_id);
	};
	
	Widget.createWithElement('tree', function(event, widget) {
		page_tree = widget;
		AdminInterface.sidebar.append(widget._element);
		widget.handle('tree.clicked', click_handler);
	}, function(widget) {
		widget.settings.description_from_item = function(item) {
			return item.Name;
		};
		widget.settings.has_children = function(item) {
			return item.TreeRight-item.TreeLeft > 1;
		};
		widget.settings.data_from_element = function(item) {
			return item.data('tree-data').Id;
		};
	}, '{{writeRequestValue=tree_session}}');
	AdminInterface.info_bar.getWidget().add_button('add-new-item', function() {
		Widget.create('page_detail', function(widget) {
			widget.open();
			widget.save_callback = function() {
				jQuery('.ui-tree').each(function() {
					jQuery(this).getWidget().reload();
				});
			};
		});
	}, 'n', false);
});


