jQuery(document).ready(function() {
	AdminInterface.sidebar.find('.ui-list').prepareWidget(function(sidebar) {
		sidebar.settings.row_click_active_mode = 'activate';
		var initial_selection = "{{writeRequestValue=document_category_id}}";
		if(initial_selection) {
			initial_selection = isNaN(initial_selection) ? initial_selection : parseInt(initial_selection);
			sidebar.handle('list.loaded', function() {
				sidebar.activate_row(sidebar.row_from_row_data({id: initial_selection}));
			}, true, true);
		}
		var document_list = AdminInterface.content.find('.document_list').getWidget();
		var info_bar = AdminInterface.info_bar.getWidget();
		info_bar.add_button('add-new-item', function() {
			Widget.create('document_detail', function(widget) {
				widget.content.find("select[name='document_category_id']").val(document_list.getOption('document_category_id'));
				widget.open();
				widget.save_callback = function() {
					jQuery('.document_list.ui-list').each(function() {
						jQuery(this).getWidget().reload();
					});
				};
			});
		}, 'n', true).add_button('add-new-item', function() {
			Widget.create('sidebar_input', function(widget) {
				widget.add_new_sidebar_input("{{writeString=documenent_category.default_name}}", 'DocumentCategory', function() {
					var row_data = sidebar.active_row();
					if(row_data.length>0) {
						// TODO: re-setting the last selected item after reload should be default functionality
						row_data = sidebar.collect_row_data(row_data);
						sidebar.handle('list.reloaded', function() {
							sidebar.activate_row(sidebar.row_from_row_data(row_data));
						}, true);
					}
					sidebar.reload();
				});
			});
		}).add_button('action', function() {
				// add options delete category, or all document or whatever
				alert('for example delete all currently shown documents');
		}).add_search_input("{{writeString=search.file}}", function(search) {
			if(document_list.setSearch(search)) {
				document_list.reload();
			}
		});

		// add row_count_info
		info_bar.add_row_count_info_for_list(document_list);
	
		// sidebar list row dblclick
		sidebar.handle('list.row-dblclick', function(event, row, element) {
			alert(element.data('document_category_id'));
		});
		// sidebar list row click
		sidebar.handle('list.row-click', function(event, row, element) {
			var document_category_id = element.data('document_category_id');
			if(!element.hasClass('ui-state-active')) {
				// handle highlight of default element or initial selection
			 	document_category_id = null;
			}
			document_list.setOption('document_category_id', document_category_id);
			document_list.reload();
		
			jQuery('#new_sidebar_input').remove();
		});
	});
});