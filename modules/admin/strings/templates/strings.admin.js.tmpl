jQuery(document).ready(function() {
	AdminInterface.content.find('table.string_list').prepareWidget(function(string_list) {
		
		// Sidebar
		var sidebar = AdminInterface.sidebar.find('.ui-list').prepareWidget(function(sidebar) {
			Widget.handle('strings-namespaces-changed', sidebar.reload.bind(sidebar));

			sidebar.settings.row_click_active_mode = 'activate';
			sidebar.handle('list-selection_changed', function(event, selection) {
				string_list.setOption('name_space', selection[0] && selection[0].name_space);
				string_list.reload();
			});
			
			sidebar.handle('list_updated', function(event) {
				
			});
		
			// Add handlers for changed namespaces
			string_list.handle('row-updated row-deleted', function(event, returnedResult) {
				if(returnedResult.namespaces_changed) {
					sidebar.reload();
				}
			});
		});

		// Info_bar elements
		AdminInterface.info_bar.prepareWidget(function(info_bar) {
			info_bar.add_button('add-new-item', function() {
				Widget.create('string_detail', function(widget) {
					widget.open();
					widget.save_callback = function(result, error) {
						if(result.namespaces_changed) {
							Widget.fire('strings-namespaces-changed');
						}
						string_list.reload();
					};
				});
			}, 'n', true).add_search_input("{{writeString=wns.search.enter_search}}", function(search) {
				if(string_list.setSearch(search)) {
					string_list.reload();
				}
			}).add_row_count_info_for_list(string_list);
		});
	});
});