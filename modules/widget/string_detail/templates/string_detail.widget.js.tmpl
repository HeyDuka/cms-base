Widget.types.string_detail = {
	initialize: function() {
		this.init_content();
		Widget.create('detail', function(widget) {
			this.detail_widget = widget.set_instance(this);
			jQuery.extend(widget.settings, {
				title: "{{writeString=wns.new_entry}}",
				width: 600
			});
			widget.content = this.content;
			if(this.auto_open) {
				this.open();
			}
		}.bind(this));
	},
	
	open: function() {
		if(!this.detail_widget) {
			this.auto_open = true;
			return false;
		}
		this.detail_widget.open();
	},
	
	fill_data: function() {
		var string_detail = this;
		// get active strings and make sure the correct ones are highlighted
		var active_languages = string_detail.getActiveLanguages();		
		
		this.getStringData(function(string_data) {
			this.content.find("input[name='string_key']").val(string_data.StringKey);
			this.detail_widget.set_title(string_data.StringKey);
		});
		if(!this.language_tabs) {
			this.init_content();
		} else {
			jQuery.each(this.language_tabs.all_tabs(), function(language_id, tab) {
				if(jQuery.inArray(language_id,active_languages) != -1) {
					tab.addClass('tab_content_active');
					tab.removeClass('tab_content_inactive');
				} else {
					tab.addClass('tab_content_inactive');
					tab.removeClass('tab_content_active');
				}
			});			
			jQuery.each(this.language_tabs.all_panels(), function(language_id, panel) {
				panel.find('textarea').val(string_detail.getTextFor(language_id));
			});
		}
	},
	
	init_content: function() {
		var string_detail = this;
		this.content = jQuery.parseHTML("{{includeTemplate=edit}}");
		var language_content = this.content.find('.edit_language_content');
		Widget.createWithElement('language_tabs', function(widget) {
			string_detail.language_tabs = widget;
			widget.handle('element_set', function(event, element) {
				language_content.append(element);
			});
		}, function(language_tabs) {
			language_tabs.handle('tab.created', function(event, language_id, tab_content) {
				var textarea = jQuery.parseHTML('{{includeTemplate=edit_language}}');
				textarea.attr('name', textarea.attr('name')+language_id);
				textarea.val(string_detail.getTextFor(language_id));
				tab_content.append(textarea);
			}, false, true);
		});
	},
	
	close: function() {
		this.detail_widget.close();
		this.close_callback();
	},
	
	save_callback: jQuery.noop,
	close_callback: jQuery.noop
};